<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fill Your Birth Details — Digdarshan Astro</title>

<link rel="stylesheet" href="style.css">

<style>
/* ================================
   GLOBAL BACKGROUND
   ================================ */
body {
  margin: 0;
  padding: 0;
  background: url("/mnt/data/2399900.jpg") no-repeat center center fixed;
  background-size: cover;
  position: relative;
}

body::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(10, 0, 25, 0.55);
  backdrop-filter: blur(2px);
  z-index: -1;
}

/* ================================
   FORM CARD
   ================================ */
.form-card {
  max-width:920px;
  margin:36px auto 80px;
  padding:34px 40px;
  border-radius:20px;
  background: rgba(8,6,18,0.78);
  box-shadow: 0 20px 60px rgba(2,6,20,0.6);
  color:#fff;
  border:1px solid rgba(255,255,255,0.05);
}

.brand-block { text-align:center; margin-bottom:10px; }
.brand-block img { width:84px; height:84px; object-fit:contain; border-radius:12px; margin:auto; }
.brand-title { font-weight:900; font-size:28px; margin-top:4px; }
.brand-sub { font-size:14px; opacity:0.9; }
.brand-link a { color:#ffd2ee; font-weight:700; }

/* STEP TABS */
.stepper { display:flex; justify-content:center; gap:28px; margin-bottom:18px; }
.step { color:rgba(255,255,255,0.65); font-weight:800; cursor:pointer; text-align:center; }
.step .bar { width:160px; height:6px; background:rgba(255,255,255,0.08); border-radius:8px; margin-bottom:6px; }
.step.active .bar { background:linear-gradient(90deg,#ff6ea6,#ff9d6d); }

/* FORM INPUTS */
.form-row { display:flex; gap:18px; flex-wrap:wrap; }
.col { flex:1; min-width:220px; }
label { font-size:13px; font-weight:700; margin-top:12px; }
input, select, textarea {
  width:100%; padding:12px 14px; border-radius:12px; border:none;
  background:rgba(255,255,255,0.08);
  color:#fff;
}
textarea { min-height:110px; }

/* BUTTONS */
.btn {
  padding:12px 26px;
  border-radius:26px;
  background:linear-gradient(90deg,#ff6ea6,#ff9d6d);
  border:none; color:#fff;
  font-weight:800; cursor:pointer;
}

.btn.ghost {
  background:transparent;
  border:1px solid rgba(255,255,255,0.3);
}

/* PREVIEW BOX */
.preview {
  margin-top:12px;
  padding:12px;
  background:rgba(255,255,255,0.05);
  border-radius:10px;
}

/* RESPONSIVE */
@media(max-width:900px){
  .form-card{ margin:20px 10px 60px; padding:20px; }
  .step .bar{ width:110px; }
}
@media(max-width:520px){
  .form-row{ flex-direction:column; }
  .brand-title{ font-size:22px; }
}
</style>
</head>

<body>

<div class="form-card">
  <div class="brand-block">
    <img src="/mnt/data/Digdarshan Astro Logo.png" alt="logo">
    <div class="brand-title">DIGDARSHAN ASTRO</div>
    <div class="brand-sub">Jyotish Devagya Amitsree — Call: 8697190840 / 9830637766</div>
    <div class="brand-link">
      <a href="https://digdarshanastro.mydurable.com/" target="_blank">
        https://digdarshanastro.mydurable.com/
      </a>
    </div>
  </div>

  <h3 style="text-align:center; margin-top:10px;">Fill Your Birth Details Consultation Type.</h3>

  <div class="stepper">
    <div class="step active" id="tab1" onclick="showStep(1)">
      <div class="bar"></div>Client Details
    </div>
    <div class="step" id="tab2" onclick="showStep(2)">
      <div class="bar"></div>Birth Details
    </div>
    <div class="step" id="tab3" onclick="showStep(3)">
      <div class="bar"></div>Consultation
    </div>
  </div>

  <form id="theForm" onsubmit="return false;">

    <!-- STEP 1 -->
    <div id="step1">

      <div class="form-row">
        <div class="col">
          <label>First Name</label>
          <input id="fname" required>
        </div>

        <div class="col">
          <label>Last Name</label>
          <input id="lname">
        </div>
      </div>

      <label>Mobile Number</label>
      <div class="form-row">
        <div style="min-width:110px;">
          <input value="+91" disabled>
        </div>
        <div class="col">
          <input id="mobile" maxlength="10" minlength="10" pattern="\d{10}" required>
        </div>
      </div>

      <label>Email</label>
      <input id="email">

      <label>Address</label>
      <input id="address">

      <div class="form-row">
        <div class="col">
          <label>City</label>
          <input id="city">
        </div>
        <div class="col">
          <label>State</label>
          <input id="state">
        </div>
      </div>

      <div class="form-row">
        <div class="col">
          <label>PIN</label>
          <input id="pin">
        </div>
        <div class="col">
          <label>Country</label>
          <input id="country" value="India">
        </div>
      </div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn" type="button" onclick="nextStep(2)">Next</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div id="step2" style="display:none;">

      <div class="form-row">
        <div class="col">
          <label>Date of Birth</label>
          <input id="dob" type="date">
        </div>

        <div class="col">
          <label>Time of Birth</label>
          <input id="tob" type="time">
        </div>
      </div>

      <label>Place of Birth</label>
      <input id="place">

      <div class="form-row">
        <div class="col">
          <label>Gotra</label>
          <input id="gotra">
        </div>

        <div class="col">
          <label>Maternal Uncle's Gotra</label>
          <input id="maternal_gotra">
        </div>
      </div>

      <div class="form-row">
        <div class="col">
          <label>Date of Marriage</label>
          <input id="anniv" type="date">
        </div>
      </div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn ghost" type="button" onclick="prevStep(1)">Back</button>
        <button class="btn" type="button" onclick="nextStep(3)">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div id="step3" style="display:none;">

      <label>Consultation Type</label>
      <select id="consultType">
        <option value="">Select</option>
        <option>Physical Visit</option>
        <option>Online Consultation</option>
      </select>

      <label>Consultation Mode</label>
      <select id="consultMode">
        <option value="">Select</option>
        <option>Free Consultation (Offline)</option>
        <option>Paid Consultation</option>
        <option>Premium Consultation (Recommended)</option>
      </select>

      <label>Preferred Remedies</label>
      <select id="remedies">
        <option value="">Select preferred remedies</option>
        <option>Gemstone</option>
        <option>Rudraksha</option>
        <option>Tantra/Kavach</option>
        <option>Home-based Remedies (Totka)</option>
      </select>

      <label>Notes (optional)</label>
      <textarea id="notes"></textarea>

      <div class="preview" id="preview"></div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn ghost" type="button" onclick="prevStep(2)">Back</button>
        <button class="btn" type="button" onclick="submitForm()">Submit</button>
      </div>

    </div>
  </form>
</div>


<!-- FIREBASE SCRIPT -->
<script type="module">
import { db } from "./firebase-config.js";
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

function showStep(n){
  document.getElementById("step1").style.display = n===1 ? "block" : "none";
  document.getElementById("step2").style.display = n===2 ? "block" : "none";
  document.getElementById("step3").style.display = n===3 ? "block" : "none";

  document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
  document.getElementById("tab"+n).classList.add("active");
}
window.showStep = showStep;

function nextStep(n){
  if(n===2){
    const m=document.getElementById("mobile").value.trim();
    if(!/^\d{10}$/.test(m)){ alert("Enter valid mobile!"); return; }
  }
  showStep(n);
}
window.nextStep = nextStep;

window.prevStep = showStep;

function buildPreview(){
  const p=[];
  p.push(`<b>Name:</b> ${document.getElementById("fname").value} ${document.getElementById("lname").value}`);
  p.push(`<b>Mobile:</b> +91 ${document.getElementById("mobile").value}`);
  p.push(`<b>DOB:</b> ${document.getElementById("dob").value}`);
  p.push(`<b>TOB:</b> ${document.getElementById("tob").value}`);
  p.push(`<b>Place:</b> ${document.getElementById("place").value}`);
  p.push(`<b>Gotra:</b> ${document.getElementById("gotra").value}`);
  p.push(`<b>Maternal Gotra:</b> ${document.getElementById("maternal_gotra").value}`);
  p.push(`<b>Consult:</b> ${document.getElementById("consultType").value} / ${document.getElementById("consultMode").value}`);
  document.getElementById("preview").innerHTML = p.join("<br>");
}

document.querySelectorAll("input,select,textarea")
.forEach(e=>{ e.addEventListener("change",buildPreview); e.addEventListener("input",buildPreview); });


window.submitForm = async function(){

  const mobile=document.getElementById("mobile").value.trim();
  if(!/^\d{10}$/.test(mobile)){ alert("Invalid mobile"); return; }

  const payload = {
    name: `${document.getElementById("fname").value} ${document.getElementById("lname").value}`,
    mobile: "+91 "+mobile,
    phone: "+91 "+mobile,
    email: document.getElementById("email").value,
    address: document.getElementById("address").value,
    city: document.getElementById("city").value,
    state: document.getElementById("state").value,
    pin: document.getElementById("pin").value,
    country: document.getElementById("country").value,

    dob: document.getElementById("dob").value,
    time: document.getElementById("tob").value,
    place: document.getElementById("place").value,

    gotra: document.getElementById("gotra").value,
    maternal_gotra: document.getElementById("maternal_gotra").value,   // NEW FIELD

    anniv: document.getElementById("anniv").value,

    consultType: document.getElementById("consultType").value,
    consultMode: document.getElementById("consultMode").value,
    remedies: document.getElementById("remedies").value,
    notes: document.getElementById("notes").value,

    createdAt: serverTimestamp()
  };

  try{
    await addDoc(collection(db,"birth_details"), payload);
    alert("Saved Successfully!");
    location.href="admin.html";
  }
  catch(e){ alert("Error saving data"); console.error(e); }
};

</script>

</body>
</html>
