<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fill Your Birth Details — Digdarshan Astro</title>

<link rel="stylesheet" href="style.css">

<style>
/* small page-level overrides for spa look */
body { background: url('/mnt/data/intake-forms-spa-client-intake-form.jpg') center/cover fixed no-repeat; }
.form-card {
  max-width: 920px;
  margin: 36px auto 80px;
  padding: 34px 40px;
  border-radius: 20px;
  background: linear-gradient(180deg, rgba(8,6,18,0.72), rgba(20,8,30,0.72));
  box-shadow: 0 20px 60px rgba(2,6,20,0.6);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.05);
}
.brand-block { text-align:center; margin-bottom: 6px; }
.brand-block img { width:84px; height:84px; object-fit:contain; border-radius:12px; }
.brand-title { font-weight:900; font-size:28px; margin-top:8px; letter-spacing:0.7px; color:#fff; }
.brand-sub { font-size:14px; color:rgba(255,255,255,0.85); margin-top:6px; font-weight:700; }
.brand-link a { color:#ffd2ee; text-decoration:underline; font-weight:800; }

.small-title { text-align:center; font-size:16px; color:rgba(255,255,255,0.9); margin:10px 0 18px; }

/* stepper */
.stepper { display:flex; justify-content:center; gap:28px; margin-bottom:20px; }
.step { text-align:center; color:rgba(255,255,255,0.55); font-weight:800; cursor:pointer; }
.step .bar { width:160px; height:6px; border-radius:8px; background:rgba(255,255,255,0.08); margin-bottom:8px; }
.step.active .bar { background: linear-gradient(90deg,#ff6ea6,#ff9d6d); box-shadow:0 8px 20px rgba(255,100,140,0.08); color:#fff; }

/* form layout */
.form-row { display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap; }
.col { flex:1; min-width:220px; }
label { display:block; font-weight:700; margin-top:12px; color:rgba(255,255,255,0.9); font-size:13px; }
input, select, textarea {
  width:100%; padding:12px 14px; border-radius:12px; border:none;
  background: rgba(255,255,255,0.08); color:#fff; outline:none; box-shadow: inset 0 -6px 12px rgba(0,0,0,0.18);
}
input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.55); }

textarea { min-height:110px; }

/* buttons */
.btn { display:inline-block; padding:12px 26px; border-radius:26px; background:linear-gradient(90deg,#ff6ea6,#ff9d6d); color:#fff; font-weight:800; border:none; cursor:pointer; }
.btn.ghost { background: transparent; border:1px solid rgba(255,255,255,0.12); color:#fff; }

/* preview */
.preview { margin-top:12px; padding:12px 14px; border-radius:10px; background: rgba(255,255,255,0.03); color:#fff; }

/* responsive */
@media (max-width:900px){
  .form-card { margin:20px 12px 60px; padding:20px; }
  .step .bar { width:110px; }
}
@media (max-width:520px){
  .form-row { flex-direction:column; }
  .brand-title { font-size:22px; }
}
</style>
</head>
<body>

<div class="form-card" role="main" aria-labelledby="formTitle">
  <div class="brand-block">
    <img src="/mnt/data/Digdarshan Astro Logo.png" alt="Digdarshan Astro">
    <div class="brand-title">DIGDARSHAN ASTRO</div>
    <div class="brand-sub">Jyotish Devagya Amitsree — Call: 8697190840 / 9830637766</div>
    <div class="brand-link"><a href="https://digdarshanastro.mydurable.com/" target="_blank">https://digdarshanastro.mydurable.com/</a></div>
  </div>

  <div class="small-title" id="formTitle">Fill Your Birth Details Consultation Type.</div>

  <div class="stepper" aria-hidden="true">
    <div class="step active" id="tab1" onclick="showStep(1)">
      <div class="bar"></div>Client Details
    </div>
    <div class="step" id="tab2" onclick="showStep(2)">
      <div class="bar"></div>Birth Details
    </div>
    <div class="step" id="tab3" onclick="showStep(3)">
      <div class="bar"></div>Consultation
    </div>
  </div>

  <form id="theForm" onsubmit="return false;">
    <!-- STEP 1 -->
    <div id="step1">
      <div class="form-row">
        <div class="col">
          <label for="fname">First Name</label>
          <input id="fname" placeholder="First Name" required>
        </div>
        <div class="col">
          <label for="lname">Last Name</label>
          <input id="lname" placeholder="Last Last">
        </div>
      </div>

      <label for="mobile">Mobile Number</label>
      <div class="form-row">
        <div style="min-width:110px;max-width:110px;">
          <input value="+91" disabled>
        </div>
        <div class="col">
          <input id="mobile" placeholder="10-digit number" maxlength="10" minlength="10" pattern="\d{10}" required>
        </div>
      </div>

      <label for="email">Email</label>
      <input id="email" placeholder="you@example.com">

      <label for="address">Address (Street)</label>
      <input id="address" placeholder="Street address">

      <div class="form-row">
        <div class="col">
          <label for="city">City</label>
          <input id="city" placeholder="City">
        </div>
        <div class="col">
          <label for="state">State / Region</label>
          <input id="state" placeholder="State">
        </div>
      </div>

      <div class="form-row">
        <div class="col">
          <label for="pin">PIN</label>
          <input id="pin" placeholder="Postal / PIN code">
        </div>
        <div class="col">
          <label for="country">Country</label>
          <input id="country" value="India">
        </div>
      </div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn" type="button" onclick="nextStep(2)">Next</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div id="step2" style="display:none;">
      <div class="form-row">
        <div class="col">
          <label for="dob">Date of Birth</label>
          <input id="dob" type="date">
        </div>
        <div class="col">
          <label for="tob">Time of Birth</label>
          <input id="tob" type="time">
        </div>
      </div>

      <label for="place">Place of Birth</label>
      <input id="place" placeholder="City / Town / Village">

      <div class="form-row">
        <div class="col">
          <label for="gotra">Gotra</label>
          <input id="gotra" placeholder="Gotra">
        </div>
        <div class="col">
          <label for="anniv">Date of Marriage</label>
          <input id="anniv" type="date">
        </div>
      </div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn ghost" type="button" onclick="prevStep(1)">Back</button>
        <button class="btn" type="button" onclick="nextStep(3)">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div id="step3" style="display:none;">
      <label for="consultType">A. Choose Consultation Type</label>
      <select id="consultType">
        <option value="">Select</option>
        <option>Physical Visit</option>
        <option>Online Consultation</option>
      </select>

      <label for="consultMode">B. Choose Consultation Mode</label>
      <select id="consultMode">
        <option value="">Select</option>
        <option>Free Consultation (offline)</option>
        <option>Paid Consultation</option>
        <option>Premium Consultation (Recommended)</option>
      </select>

      <!-- UPDATED FIELD -->
      <label for="remedies">C. Preferred Remedies</label>
      <select id="remedies">
        <option value="">Select</option>
        <option>Gemstone</option>
        <option>Rudraksha</option>
        <option>Tantra / Kavach</option>
        <option>Home based Remedies (Totka)</option>
      </select>

      <label for="notes">Notes (optional)</label>
      <textarea id="notes" placeholder="Anything for the astrologer..."></textarea>

      <div class="preview" id="preview"></div>

      <div style="text-align:center;margin-top:18px;">
        <button class="btn ghost" type="button" onclick="prevStep(2)">Back</button>
        <button class="btn" type="button" onclick="submitForm()">Submit</button>
      </div>
    </div>

  </form>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

function showStep(n){
  document.getElementById('step1').style.display = n===1?'block':'none';
  document.getElementById('step2').style.display = n===2?'block':'none';
  document.getElementById('step3').style.display = n===3?'block':'none';
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  document.getElementById('tab'+n).classList.add('active');
  window.scrollTo({top:0, behavior:'smooth'});
}
window.showStep = showStep;

function nextStep(n){
  // validations before moving forward
  if(n===2){
    const m = document.getElementById('mobile').value.trim();
    if(!/^\d{10}$/.test(m)) { alert('Please enter a valid 10-digit mobile number'); return; }
  }
  showStep(n);
}
function prevStep(n){ showStep(n); }
window.nextStep = nextStep; window.prevStep = prevStep;

function buildPreview(){
  const name = (document.getElementById('fname').value + ' ' + document.getElementById('lname').value).trim();
  const p = [
    `<b>Name:</b> ${name||'—'}`,
    `<b>Mobile:</b> +91 ${document.getElementById('mobile').value||'—'}`,
    `<b>DOB:</b> ${document.getElementById('dob').value||'—'}`,
    `<b>TOB:</b> ${document.getElementById('tob').value||'—'}`,
    `<b>Place:</b> ${document.getElementById('place').value||'—'}`,
    `<b>Consult:</b> ${document.getElementById('consultType').value||'—'} / ${document.getElementById('consultMode').value||'—'}`,
    `<b>Remedies:</b> ${document.getElementById('remedies').value||'—'}`
  ];
  document.getElementById('preview').innerHTML = p.join('<br>');
}

document.querySelectorAll('#consultType,#consultMode,#remedies').forEach(el=>{
  el.addEventListener('change', buildPreview);
});

window.submitForm = async function(){
  // final validation
  const mobile = document.getElementById('mobile').value.trim();
  if(!/^\d{10}$/.test(mobile)) { alert('Enter a valid 10-digit mobile.'); showStep(1); return; }

  buildPreview();

  const payload = {
    name: (document.getElementById('fname').value + ' ' + document.getElementById('lname').value).trim(),
    mobile: '+91 ' + mobile,
    phone: '+91 ' + mobile,
    email: document.getElementById('email').value || '',
    address: document.getElementById('address').value || '',
    city: document.getElementById('city').value || '',
    state: document.getElementById('state').value || '',
    pin: document.getElementById('pin').value || '',
    country: document.getElementById('country').value || '',
    dob: document.getElementById('dob').value || '',
    tob: document.getElementById('tob').value || '',
    place: document.getElementById('place').value || '',
    gotra: document.getElementById('gotra').value || '',
    anniv: document.getElementById('anniv').value || '',
    consultType: document.getElementById('consultType').value || '',
    consultMode: document.getElementById('consultMode').value || '',
    remedies: document.getElementById('remedies').value || '',
    notes: document.getElementById('notes').value || '',
    createdAt: serverTimestamp()
  };

  try {
    await addDoc(collection(db, 'birth_details'), payload);
    alert('Saved successfully!');
    location.reload();
  } catch(err){
    console.error(err);
    alert('Save failed — check Firebase rules or console.');
  }
};
</script>
</body>
</html>
